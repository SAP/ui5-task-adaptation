var e={};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("path"),n={applyChanges:function(e,t,n){var r=Object.assign({},e);return n.registry().then((function(e){return t.forEach((function(t){try{var i=e[t.getChangeType()];r=i.applyChange(r,t),!i.skipPostprocessing&&t.getTexts()&&(r=n.processTexts(r,t.getTexts()))}catch(e){n.handleError(e)}})),r}))}};class r{constructor(e){this.value=e}normalize(){return this.value=t.normalize(this.value),this}path(){return this.value}}var i={formatBundleName:function(e,t){if(t.startsWith("/"))throw Error("Absolute paths are not supported");return new r(e+"/"+t).normalize().path().replace(/\//g,".").replace("..",".").replace(/.properties$/g,"")}},o=function(e){this._oDefinition=e};o.prototype.getChangeType=function(){if(this._oDefinition)return this._oDefinition.changeType},o.prototype.getContent=function(){return this._oDefinition.content},o.prototype.getTexts=function(){return this._oDefinition.texts};var a=/^[0-9]+(?:\.([0-9]+)(?:\.([0-9]+))?)?(.*)$/;function s(t,n,r,i){if(t instanceof s)return t;if(!(this instanceof s))return new s(t,n,r,i);var o;function p(e){return e=parseInt(e),isNaN(e)?0:e}o="string"==typeof t?a.exec(t):Array.isArray(t)?t:arguments,t=p((o=o||[])[0]),n=p(o[1]),r=p(o[2]),i=String(o[3]||""),this.toString=function(){return t+"."+n+"."+r+i},this.getMajor=function(){return t},this.getMinor=function(){return n},this.getPatch=function(){return r},this.getSuffix=function(){return i},this.compareTo=function(){var o=s.apply(e,arguments);return t-o.getMajor()||n-o.getMinor()||r-o.getPatch()||(i<o.getSuffix()?-1:i===o.getSuffix()?0:1)}}s.prototype.inRange=function(e,t){return this.compareTo(e)>=0&&this.compareTo(t)<0};var p={appdescr_ui5_addLibraries:{applyChange:function(e,t){e["sap.ui5"].dependencies.libs||(e["sap.ui5"].dependencies.libs={});var n=e["sap.ui5"].dependencies.libs,r=t.getContent().libraries;return Object.keys(r).forEach((function(e){n[e]?n[e]=function(e,t){var n={};if(t.minVersion){var r=new s(e.minVersion);n.minVersion=r.compareTo(t.minVersion)>=0?e.minVersion:t.minVersion}return t.lazy&&(n.lazy=e.lazy===t.lazy==1),n}(n[e],r[e]):n[e]=r[e]})),e}},appdescr_app_setTitle:{applyChange:function(e){return e["sap.app"].title="{{"+e["sap.app"].id+"_sap.app.title}}",e}}},u={},c=e;function f(e){return Array.isArray(e)?e.slice():e.split(".")}u.create=function(e,t){for(var n=t||c,r=f(e),i=0;i<r.length;i++){var o=r[i];if(null===n[o]||void 0!==n[o]&&"object"!=typeof n[o]&&"function"!=typeof n[o])throw new Error("Could not set object-path for '"+r.join(".")+"', path segment '"+o+"' already exists.");n[o]=n[o]||{},n=n[o]}return n},u.get=function(e,t){for(var n=t||c,r=f(e),i=r.pop(),o=0;o<r.length&&n;o++)n=n[r[o]];return n?n[i]:void 0},u.set=function(e,t,n){n=n||c;var r=f(e),i=r.pop();u.create(r,n)[i]=t};var g={appdescr_app_changeDataSource:{applyChange:function(e,t){if(!e["sap.app"].dataSources)throw Error("No sap.app/dataSource found in manifest.json");var n=t.getContent(),r=e["sap.app"].dataSources[n.dataSourceId];if(r){var i=n.entityPropertyChange;if(Array.isArray(i)||"UPDATE"!==i.operation)throw new Error("Only operation == 'UPDATE' and entityPropertyChanges of type object are supported.");var o=i.propertyPath.split("/");u.set(o,i.propertyValue,r)}return e}},appdescr_ui5_addNewModelEnhanceWith:{applyChange:function(e,t){var n=t.getContent().modelId,r=i.formatBundleName(e["sap.app"].id,t.getTexts().i18n),o=e["sap.ui5"].models[n];o&&(o.type&&"sap.ui.model.resource.ResourceModel"===o.type&&(o.settings&&o.settings.enhanceWith||u.set("settings.enhanceWith",[],o),o.settings.enhanceWith.push({bundleName:r})));return e},skipPostprocessing:!0},appdescr_ui5_addComponentUsages:{applyChange:function(e,t){var n=t.getContent().componentUsages;e["sap.ui5"].componentUsages||(e["sap.ui5"].componentUsages={});var r=e["sap.ui5"].componentUsages;return Object.keys(n).forEach((function(e){if(r[e])throw new Error("Component usage '"+e+"' already exists");r[e]=n[e]})),e}},appdescr_ui5_setMinUI5Version:{applyChange:function(e,t){return new s(e["sap.ui5"].dependencies.minUI5Version).compareTo(t.getContent().minUI5Version)<=0&&(e["sap.ui5"].dependencies.minUI5Version=t.getContent().minUI5Version),e}},appdescr_fiori_setRegistrationIds:{applyChange:function(e,t){return u.set(["sap.fiori","registrationIds"],t.getContent().registrationIds,e),e}},appdescr_ui5_setFlexExtensionPointEnabled:{applyChange:function(e,t){if(!t.getContent().flexExtensionPointEnabled)throw new Error("No flexExtensionPointEnabled in change content provided");return u.set(["sap.ui5","flexExtensionPointEnabled"],t.getContent().flexExtensionPointEnabled,e),e}}},l=Object.assign({},p),h=Object.assign(l,g);exports.Applier=n,exports.ApplyUtil=i,exports.Change=o,exports.RegistrationBuild=h;
